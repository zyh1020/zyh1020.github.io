"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[9740],{8034:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>l,data:()=>t});var e=a(641);const n={},l=(0,a(6262).A)(n,[["render",function(i,s){return(0,e.uX)(),(0,e.CE)("div",null,s[0]||(s[0]=[(0,e.Fv)('<h3 id="一-基础安装" tabindex="-1"><a class="header-anchor" href="#一-基础安装"><span>一，基础安装</span></a></h3><h4 id="_1-1-安装erlang" tabindex="-1"><a class="header-anchor" href="#_1-1-安装erlang"><span>1.1 安装ErLang</span></a></h4><p>由于RabbitMQ是基于Erlang语言开发的，所以在安装RabbitMQ之前需要先安装Erlang的运行环境。</p><p>erlang与RabbitMQ版本的对应关系:<a href="https://www.rabbitmq.com/which-erlang.html" target="_blank" rel="noopener noreferrer">https://www.rabbitmq.com/which-erlang.html</a></p><p>如：RabbitMQ3.6.10，建议的erlang最小版本是R16Bo3，最大版本19.3.x</p><img src="http://img.zouyh.top/article-img/20240917135105343.png" alt="image-20230424104117398" style="zoom:50%;"><p>erlang各个版本的下载：<a href="https://www.erlang.org/downloads" target="_blank" rel="noopener noreferrer">https://www.erlang.org/downloads</a></p><img src="http://img.zouyh.top/article-img/20240917135105341.png" alt="image-20230424104348852" style="zoom:50%;"><h4 id="_1-2-安装rabbitmq" tabindex="-1"><a class="header-anchor" href="#_1-2-安装rabbitmq"><span>1.2 安装RabbitMQ</span></a></h4><p>①，官网地址下载地址：<a href="https://www.rabbitmq.com/download.html" target="_blank" rel="noopener noreferrer">https://www.rabbitmq.com/download.html</a></p><p>②，将下载好的erlang和RabbitMq文件，一起上传到/usr/local/software 目录下(如果没有 software 需要自己创建)</p><p>③，进入到usr/local/software 目录，分别执行如下命令安装，注意按照以下顺序安装</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>rpm -ivh erlang-21.3-1.el7.x86_64.</span></span>\n<span class="line"><span>rpm yum install socat -y </span></span>\n<span class="line"><span>rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>常用命令：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加开机启动 RabbitMQ 服务        </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chkconfig</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rabbitmq-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动服务</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmq-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看服务状态</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmq-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 停止服务(选择执行)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmq-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-web-管理插件" tabindex="-1"><a class="header-anchor" href="#_1-3-web-管理插件"><span>1.3 web 管理插件</span></a></h4><p>停止RabbitMQ服务后,开启 web 管理插件:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>rabbitmq-plugins enable rabbitmq_management</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>用默认账号密码(guest)访问地址 <a href="http://ip:15672/%E5%87%BA%E7%8E%B0%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98" target="_blank" rel="noopener noreferrer">http://ip:15672/出现权限问题</a></p><figure><img src="http://img.zouyh.top/article-img/20240917135105342.png" alt="image-20230424114410746" tabindex="0" loading="lazy"><figcaption>image-20230424114410746</figcaption></figure><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加一个新的用户创建账号      </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add_user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> admin</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置用户角色 </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set_user_tags</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> admin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> administrator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置用户权限 </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set_permissions</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> admin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;.*&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;.*&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;.*&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看当前用户和角色 </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list_users</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 再次利用 admin 用户登录</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重置命令 关闭应用的命令为</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop_app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 清除的命令为 </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重新启动命令为 </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start_app</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二-docker安装" tabindex="-1"><a class="header-anchor" href="#二-docker安装"><span>二，docker安装</span></a></h3><p>第一步：在docker hub 中查找rabbitmq镜像，带有“mangement”的版本，包含web管理页面</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-dockerfile"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">docker search rabbitmq:3.9.12-management</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>第二步：从docker hub 中拉取rabbitmq镜像</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>docker pull rabbitmq:3.9.12-management</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>第三步：查看拉取的rabbitmq镜像</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>docker images</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>第四步：运行 rabbitmq服务端</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>docker run -d \\</span></span>\n<span class="line"><span>-v /opt/rabbitmq/data:/root/rabbitmq/data \\</span></span>\n<span class="line"><span>-p 5672:5672 -p 15672:15672 --name rabbitmq --restart=always \\</span></span>\n<span class="line"><span>--hostname myRabbit rabbitmq:3.9.12-management</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第五步：查看正在运行的容器</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>docker ps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>第六步：容器运行成功之后，在浏览器访问： ip+15672，账号 guest ， 密码 guest</p><h3 id="三-集群安装" tabindex="-1"><a class="header-anchor" href="#三-集群安装"><span>三，集群安装</span></a></h3><p><strong>安装</strong></p><p>采用上面的基础安装启动三台MQ，假设三台MQ分别为MQ1，MQ2，MQ3。</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 3台机器的主机名称</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># MQ1中执行</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hostnamectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set‐hostname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node0</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># MQ2中执行</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hostnamectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set‐hostname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node1</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># MQ3中执行</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">hostnamectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set‐hostname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> node2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在MQ1中执行如下命令，将MQ1的cookie文件，推送给MQ2和MQ3以确保各个节点的cookie文件使用的是同一个值。</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">scp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/rabbitmq/.erlang.cookie</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root@node2:/var/lib/rabbitmq/.erlang.cookie</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">scp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/rabbitmq/.erlang.cookie</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root@node3:/var/lib/rabbitmq/.erlang.cookie</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在节点 MQ2 执行如下命令：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#rabbitmqctl stop会将Erlang虚拟机关闭，rabbitmqctl stop_app只关闭 RabbitMQ 服务</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop_app</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重置节点，数据会清除</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --ram 设置为内存存储，默认为 disc 磁盘存储; rabbit@node1是该节点所在集群中的名称，node2指定就是hostname的名称</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> join_cluster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --ram</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rabbit@node1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从重启RabbitMQ 服务</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbit@node1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start_app</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在节点 MQ3执行如下命令：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">s#rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop会将Erlang虚拟机关闭，rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop_app只关闭</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RabbitMQ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 服务</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop_app</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重置节点，数据会清除</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># --ram 设置为内存存储，默认为 disc 磁盘存储; rabbit@node2是该节点所在集群中的名称，node2指定就是hostname的名称</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> join_cluster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --ram</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rabbit@node2</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从重启RabbitMQ 服务</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbit@node1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start_app</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看集群状态</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rabbitmqctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cluster_status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>配置镜像队列</strong></p><p>在任意的节点中执行如下命令：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>rabbitmqctl set_policy ha-all &quot;^&quot; &#39;{&quot;ha-mode&quot;:&quot;all&quot;}&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>解释：</p><ul><li><code>rabbitmqctl set_policy</code> ：用于设置策略。</li><li><code>ha-all</code> ： 表示设置为镜像队列并策略为所有节点可用 ，意味着 队列会被（同步）到所有的节点，当一个节点被加入到集群中时，也会同步到新的节点中，此策略比较保守，性能相对低，对接使用半数原则方式设置（N/2+1），例如：有3个结点 此时可以设置为：ha-two 表示同步到2个结点即可。</li><li><code>&quot;^&quot; </code> ：表示针对的队列的名称的正则表达式，此处表示匹配所有的队列名称。</li><li><code>&#39;{&quot;ha-mode&quot;:&quot;all&quot;}&#39; </code>：设置一组key/value的JSON 设置为高可用模式 匹配所有exchange。</li></ul><p>**负载：**RabbitMQ是不支持负载的，我们可以通过nginx或者HAProxy实现负载。注意要配置15672和5672两个端口。</p><p><strong>解除集群步骤</strong></p><p>解除集群节点(MQ2和 MQ3机器分别执行)</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>rabbitmqctl stop_app  </span></span>\n<span class="line"><span>rabbitmqctl reset  </span></span>\n<span class="line"><span>rabbitmqctl start_app  </span></span>\n<span class="line"><span>rabbitmqctl cluster_status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解除集群节点(MQ1 机器上执行)</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>rabbitmqctl forget_cluster_node rabbit@node2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>',56)]))}]]),t=JSON.parse('{"path":"/blog/MQ/RabbitMQ%E5%AE%89%E8%A3%85.html","title":"RabbitMQ安装","lang":"zh-CN","frontmatter":{"icon":"file-lines","title":"RabbitMQ安装","author":"Ms.Zyh","date":"2230-08-21T00:00:00.000Z","category":["MQ"],"tag":["推荐","MQ"],"sticky":false,"star":false,"description":"一，基础安装 1.1 安装ErLang 由于RabbitMQ是基于Erlang语言开发的，所以在安装RabbitMQ之前需要先安装Erlang的运行环境。 erlang与RabbitMQ版本的对应关系:https://www.rabbitmq.com/which-erlang.html 如：RabbitMQ3.6.10，建议的erlang最小版本是R1...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"RabbitMQ安装\\",\\"image\\":[\\"http://img.zouyh.top/article-img/20240917135105342.png\\"],\\"datePublished\\":\\"2230-08-21T00:00:00.000Z\\",\\"dateModified\\":\\"2025-09-20T07:21:23.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Ms.Zyh\\"}]}"],["meta",{"property":"og:url","content":"http://img.zouyh.top/blog/MQ/RabbitMQ%E5%AE%89%E8%A3%85.html"}],["meta",{"property":"og:site_name","content":"Mr.Zyh"}],["meta",{"property":"og:title","content":"RabbitMQ安装"}],["meta",{"property":"og:description","content":"一，基础安装 1.1 安装ErLang 由于RabbitMQ是基于Erlang语言开发的，所以在安装RabbitMQ之前需要先安装Erlang的运行环境。 erlang与RabbitMQ版本的对应关系:https://www.rabbitmq.com/which-erlang.html 如：RabbitMQ3.6.10，建议的erlang最小版本是R1..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"http://img.zouyh.top/article-img/20240917135105342.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-20T07:21:23.000Z"}],["meta",{"property":"article:author","content":"Ms.Zyh"}],["meta",{"property":"article:tag","content":"MQ"}],["meta",{"property":"article:tag","content":"推荐"}],["meta",{"property":"article:published_time","content":"2230-08-21T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-20T07:21:23.000Z"}]]},"git":{"createdTime":1755935409000,"updatedTime":1758352883000,"contributors":[{"name":"zyh1020","username":"zyh1020","email":"898362059@qq.pcom","commits":3,"url":"https://github.com/zyh1020"}]},"readingTime":{"minutes":3.75,"words":1124},"filePathRelative":"blog/MQ/RabbitMQ安装.md","excerpt":"<h3>一，基础安装</h3>\\n<h4>1.1 安装ErLang</h4>\\n<p>由于RabbitMQ是基于Erlang语言开发的，所以在安装RabbitMQ之前需要先安装Erlang的运行环境。</p>\\n<p>erlang与RabbitMQ版本的对应关系:<a href=\\"https://www.rabbitmq.com/which-erlang.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://www.rabbitmq.com/which-erlang.html</a></p>\\n<p>如：RabbitMQ3.6.10，建议的erlang最小版本是R16Bo3，最大版本19.3.x</p>","autoDesc":true}')}}]);