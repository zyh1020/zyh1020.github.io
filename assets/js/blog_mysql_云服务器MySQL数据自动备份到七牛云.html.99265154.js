"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[1604],{1199:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>h,data:()=>e});var n=a(641);const l={},h=(0,a(6262).A)(l,[["render",function(s,i){return(0,n.uX)(),(0,n.CE)("div",null,i[0]||(i[0]=[(0,n.Fv)('<p>对于我这种小网站，虽然没几个人访问，但是我担心呀！我害怕呀！hhhh，所以为了我这个小破站能够正常的运行下去，我决定备份一下数据。</p><blockquote><p>目标：将mysql数据定时备份到七牛云<br> ￼</p></blockquote><h3 id="一-下载安装qshell工具" tabindex="-1"><a class="header-anchor" href="#一-下载安装qshell工具"><span>一，下载安装qshell工具</span></a></h3><p>qshell 是基于七牛 API 服务的命令行工具，介绍和下载网址：<a href="https://developer.qiniu.com/kodo/1302/qshell" target="_blank" rel="noopener noreferrer">https://developer.qiniu.com/kodo/1302/qshell</a></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 下载文件</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  https://github.com/qiniu/qshell/releases/download/v2.12.0/qshell-v2.12.0-linux-386.tar.gz</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 解压</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -xvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> qshell-v2.12.0-linux-386.tar.gz</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置环境变量</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> qshell</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 赋执行的权限</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/qshell</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 执行qshell，输出帮助信息，表示安装成功</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二-编写脚本" tabindex="-1"><a class="header-anchor" href="#二-编写脚本"><span>二，编写脚本</span></a></h3><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 定义备份的参数 将以下参数修改为你的</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">BACKUP_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/mysqlBack/sql</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">MYSQL_CONTAINER_NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mysql</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">MYSQL_USER</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">root</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">MYSQL_PASSWORD</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">blog123456</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DATABASE_NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">blog</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">DATE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +&quot;%Y%m%d%H%M%S&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/mysqlBack/backup.log</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">QSHELL_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/usr/bin</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">BUCKET_NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ACCESS_KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SECRET_KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 备份MySQL数据库 输出日志</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">BACK_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  $DATABASE_NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$DATE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.sql</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> “====开始备份====“</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOG_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $MYSQL_CONTAINER_NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/mysqldump</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $MYSQL_USER</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --password=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$MYSQL_PASSWORD</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $DATABASE_NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKUP_DIR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACK_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOG_FILE</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> “====备份完成====“</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOG_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> “====开始上传====“</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOG_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$QSHELL_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/qshell account </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ACCESS_KEY</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $SECRET_KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &gt; /dev/null</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$QSHELL_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/qshell rput </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BUCKET_NAME</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  $BACKUP_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACK_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mysql/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACK_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> true &gt;&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> “====上传完成====“</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOG_FILE</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 删除超过7天的备份文件</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKUP_DIR</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -type</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -mtime</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +7</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;*.sql&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -exec</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {}</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三-设置定时任务" tabindex="-1"><a class="header-anchor" href="#三-设置定时任务"><span>三，设置定时任务</span></a></h3><p>使用cron job来每天自动运行这个脚本：<code>crontab -e</code>，进入编译器，i，插入：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sh"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/sh/backup_mysql.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>每天3点执行脚本/root/sh/backup_mysql.sh,查看定时任务：<code>crontab -l</code></p>',11)]))}]]),e=JSON.parse('{"path":"/blog/mysql/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8MySQL%E6%95%B0%E6%8D%AE%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91.html","title":"云服务器MySQL数据自动备份到七牛云","lang":"zh-CN","frontmatter":{"icon":"file-lines","title":"云服务器MySQL数据自动备份到七牛云","author":"Ms.Zyh","date":"2023-11-02T00:00:00.000Z","category":["mysql"],"tag":["常用","mysql"],"sticky":false,"star":false,"description":"对于我这种小网站，虽然没几个人访问，但是我担心呀！我害怕呀！hhhh，所以为了我这个小破站能够正常的运行下去，我决定备份一下数据。 目标：将mysql数据定时备份到七牛云 ￼ 一，下载安装qshell工具 qshell 是基于七牛 API 服务的命令行工具，介绍和下载网址：https://developer.qiniu.com/kodo/1302/qs...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"云服务器MySQL数据自动备份到七牛云\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-11-02T00:00:00.000Z\\",\\"dateModified\\":\\"2025-09-20T07:21:23.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Ms.Zyh\\"}]}"],["meta",{"property":"og:url","content":"http://img.zouyh.top/blog/mysql/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8MySQL%E6%95%B0%E6%8D%AE%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E5%88%B0%E4%B8%83%E7%89%9B%E4%BA%91.html"}],["meta",{"property":"og:site_name","content":"Mr.Zyh"}],["meta",{"property":"og:title","content":"云服务器MySQL数据自动备份到七牛云"}],["meta",{"property":"og:description","content":"对于我这种小网站，虽然没几个人访问，但是我担心呀！我害怕呀！hhhh，所以为了我这个小破站能够正常的运行下去，我决定备份一下数据。 目标：将mysql数据定时备份到七牛云 ￼ 一，下载安装qshell工具 qshell 是基于七牛 API 服务的命令行工具，介绍和下载网址：https://developer.qiniu.com/kodo/1302/qs..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-20T07:21:23.000Z"}],["meta",{"property":"article:author","content":"Ms.Zyh"}],["meta",{"property":"article:tag","content":"mysql"}],["meta",{"property":"article:tag","content":"常用"}],["meta",{"property":"article:published_time","content":"2023-11-02T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-20T07:21:23.000Z"}]]},"git":{"createdTime":1755935409000,"updatedTime":1758352883000,"contributors":[{"name":"zyh1020","username":"zyh1020","email":"898362059@qq.pcom","commits":3,"url":"https://github.com/zyh1020"}]},"readingTime":{"minutes":1.27,"words":380},"filePathRelative":"blog/mysql/云服务器MySQL数据自动备份到七牛云.md","excerpt":"<p>对于我这种小网站，虽然没几个人访问，但是我担心呀！我害怕呀！hhhh，所以为了我这个小破站能够正常的运行下去，我决定备份一下数据。</p>\\n<blockquote>\\n<p>目标：将mysql数据定时备份到七牛云<br>\\n￼</p>\\n</blockquote>\\n<h3>一，下载安装qshell工具</h3>\\n<p>qshell 是基于七牛 API 服务的命令行工具，介绍和下载网址：<a href=\\"https://developer.qiniu.com/kodo/1302/qshell\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://developer.qiniu.com/kodo/1302/qshell</a></p>","autoDesc":true}')}}]);