<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"jvm对象的结构和创建","image":[""],"datePublished":"2023-07-16T00:00:00.000Z","dateModified":"2025-09-20T07:21:23.000Z","author":[{"@type":"Person","name":"Ms.Zyh"}]}</script><meta property="og:url" content="http://img.zouyh.top/blog/Jvm/jvm%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%88%9B%E5%BB%BA.html"><meta property="og:site_name" content="Mr.Zyh"><meta property="og:title" content="jvm对象的结构和创建"><meta property="og:description" content="一，对象的结构 image-20230208164713119 1.1 对象头 ​ HotSpot虚拟机的对象头主要包括两部分信息markword和klass，如果是数组实例还会包含数组长度。 1.1.2 markword ​ 第一部分markword,用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-09-20T07:21:23.000Z"><meta property="article:author" content="Ms.Zyh"><meta property="article:tag" content="Jvm"><meta property="article:tag" content="干货"><meta property="article:published_time" content="2023-07-16T00:00:00.000Z"><meta property="article:modified_time" content="2025-09-20T07:21:23.000Z"><link rel="icon" href="http://zouyh.top/favicon.png"><title>jvm对象的结构和创建 | Mr.Zyh</title><meta name="description" content="一，对象的结构 image-20230208164713119 1.1 对象头 ​ HotSpot虚拟机的对象头主要包括两部分信息markword和klass，如果是数组实例还会包含数组长度。 1.1.2 markword ​ 第一部分markword,用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、...">
    <link rel="stylesheet" href="/assets/css/styles.1ccf6931.css">
    <link rel="preload" href="/assets/js/runtime~app.5f83f5f7.js" as="script"><link rel="preload" href="/assets/css/styles.1ccf6931.css" as="style"><link rel="preload" href="/assets/js/3836.cbb80532.js" as="script"><link rel="preload" href="/assets/js/app.69f6dbe1.js" as="script">
    <link rel="prefetch" href="/assets/js/blog_zookeeper_zookeeper源码解析.html.f9149778.js" as="script"><link rel="prefetch" href="/assets/js/blog_Spring_spring的AOP原理解析.html.5ac71c69.js" as="script"><link rel="prefetch" href="/assets/js/blog_Spring_spring的IOC加载整体流程.html.f5be1a10.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_结构模式-代理模式.html.fb27fd5f.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_mybatis源码解析Mapp配置文件.html.e8ace3ad.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_mybatis源码解析核心配置文件.html.35578c3e.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_mybatis源码解析sql执行.html.4a4ba04f.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_RocketMQ核心操作.html.2d434f38.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_mybatis缓存.html.a4e42d4c.js" as="script"><link rel="prefetch" href="/assets/js/blog_Spring_spring的事务原理解析.html.28f7fdbb.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringMvc_springMvc源码解析.html.7b4a5329.js" as="script"><link rel="prefetch" href="/assets/js/blog_Redis_redis实现分布式锁.html.6afb7060.js" as="script"><link rel="prefetch" href="/assets/js/blog_zookeeper_zookeeper实现分布式锁.html.0ca14e44.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_SpringBoot的run方法.html.3bf1bfc6.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_ReentrantLock原理解析.html.1a8aedd0.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_spring整合mybatis源码解析.html.32cf310f.js" as="script"><link rel="prefetch" href="/assets/js/blog_zookeeper_手写zookeeper配置中心.html.b85c21d6.js" as="script"><link rel="prefetch" href="/assets/js/blog_Dubbo_dubbo中的spi机制.html.aab57cc3.js" as="script"><link rel="prefetch" href="/assets/js/blog_Spring_spring的循环依赖.html.255d937d.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_RabbitMQ的各种队列.html.1412764f.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_SpringBoot事件监听.html.7bb26280.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_nacos的服务治理.html.d4ba30a3.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_QLExpress表达式.html.35d8ab3c.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_RabbitMQ六种工作模式.html.7857a89c.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_mybatis插件.html.1c376c1b.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_SpringBoot自动装配原理.html.6daa16a9.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_Lambda和Stream.html.77b8e258.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_ReentrantReadWriteLock原理.html.19d48ea5.js" as="script"><link rel="prefetch" href="/assets/js/blog_工作流_flowable请假流程案例.html.6b31ab57.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_RabbitMQ消息的可靠传递.html.b90798c4.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_SpringBoot内嵌tomcat原理解析.html.eb33c70b.js" as="script"><link rel="prefetch" href="/assets/js/blog_Dubbo_@DubboReference注解.html.491609cd.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_CAS和Atomic.html.3cac4fe4.js" as="script"><link rel="prefetch" href="/assets/js/blog_zookeeper_手写zookeeper注册中心.html.32982239.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_线程池ThreadPoolExecutor.html.90aead69.js" as="script"><link rel="prefetch" href="/assets/js/2664.7a9b3920.js" as="script"><link rel="prefetch" href="/assets/js/blog_Jvm_jvm类加载机制.html.27748a8a.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_SpringBoot外置tomcat原理解析.html.1651bab4.js" as="script"><link rel="prefetch" href="/assets/js/blog_Netty_BIO，NIO和AIO模型.html.6e1d7c44.js" as="script"><link rel="prefetch" href="/assets/js/blog_Redis_Redis核心数据结构.html.f4ea7ec2.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_RabbitMQ整合Spring或SpringBoot.html.9fb7b9f0.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringMvc_SpringMvc使用Validation参数校验.html.788d8738.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_Semaphore原理.html.272c6a68.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_Mybatis动态数据源.html.f0e401a9.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_HashMap原理.html.019f4477.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_反射.html.c3e18186.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_OpenFeign.html.781d404d.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_创建模式-工厂模式.html.7d3e43fa.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_String字符串常量池.html.07f86317.js" as="script"><link rel="prefetch" href="/assets/js/blog_Redis_Redis缓存设计.html.522c6cff.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_java对象的拷贝.html.fc70ae61.js" as="script"><link rel="prefetch" href="/assets/js/blog_Jvm_jvm对象的结构和创建.html.66112e60.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_ConcurrentHashMap分段锁.html.d69ccd96.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_结构模式-适配器模式.html.45bce7e2.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_java异常.html.b848f510.js" as="script"><link rel="prefetch" href="/assets/js/blog_zookeeper_zookeeper常用命令.html.001ef594.js" as="script"><link rel="prefetch" href="/assets/js/blog_Spring_Spring的@Conditional注解.html.aab3d2b3.js" as="script"><link rel="prefetch" href="/assets/js/blog_Redis_Redis主从，哨兵和集群模式.html.b0b13788.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_Sentinel限流.html.3c88a4df.js" as="script"><link rel="prefetch" href="/assets/js/blog_工作流_flowable 会签、转派、委派、加签.html.2eb1bb4d.js" as="script"><link rel="prefetch" href="/assets/js/8300.507decb8.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_线程基础.html.df32490f.js" as="script"><link rel="prefetch" href="/assets/js/blog_Redis_Redis发布订阅，锁和事务.html.b0434f88.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_SpringBoot注册Bean的6种方式.html.fd3b8781.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_volatile的原理.html.1c3a6a52.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_@SentinelResource注解.html.6e4ccc5c.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_关系模式-责任链模式.html.12d8ea08.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_mysql的锁.html.eab287d2.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_创建模式-生成器模式.html.ca6dbe34.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_关系模式-策略模式.html.d7d189f0.js" as="script"><link rel="prefetch" href="/assets/js/blog_Jvm_jvm调优工具.html.89329397.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_MySQL的sql执行流程.html.ffac322f.js" as="script"><link rel="prefetch" href="/assets/js/blog_Jvm_jvm垃圾收集器.html.c18b1d48.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_mysql的索引.html.ead29a05.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_浮点精度（float、double）运算不精确的原因.html.89ca79ce.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_CountDownLatch和CyclicBarrier.html.e58c0345.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_创建模式-单例模式.html.3809af6d.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_SpringCloud项目创建.html.e508e729.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_结构模式-装饰者模式.html.c68af9f3.js" as="script"><link rel="prefetch" href="/assets/js/blog_Jvm_JVM的垃圾回收机制.html.8689baa9.js" as="script"><link rel="prefetch" href="/assets/js/blog_Nginx_一篇搞定nignx.html.d5683f8d.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_RabbitMQ安装.html.d891f497.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_Sentinel熔断.html.5274d1f9.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_JMM模型.html.48bb6b04.js" as="script"><link rel="prefetch" href="/assets/js/blog_工作流_SpringBoot整合flowable.html.9a7ea5ef.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_mysql的事务.html.bb8f98b7.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_安装RocketMQ.html.7fc5d983.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_SpringBoot自定义starter.html.a408b7e2.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_MySQL的MVCC.html.02c99891.js" as="script"><link rel="prefetch" href="/assets/js/blog_Redis_Redis持久化.html.8629d288.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_nacos的安装.html.defb6225.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_synchronized底层原理 .html.fbeff0cd.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_nacos快速开始.html.e24d7b56.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_java运算符优先级.html.71e367b0.js" as="script"><link rel="prefetch" href="/assets/js/blog_Docker_安装nginx.html.b35574ef.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_java访问权限修饰符.html.bf0c2099.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_云服务器MySQL数据自动备份到七牛云.html.99265154.js" as="script"><link rel="prefetch" href="/assets/js/blog_zookeeper_安装zookeeper.html.e1a4f47c.js" as="script"><link rel="prefetch" href="/assets/js/blog_Docker_linux安装docker.html.2fd80aef.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_mysql的Buffer Pool.html.cded46b3.js" as="script"><link rel="prefetch" href="/assets/js/blog_Nginx_SSL证书安装.html.39272e04.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_NavicatPremium16的安装与激活.html.5639708d.js" as="script"><link rel="prefetch" href="/assets/js/blog_Docker_安装mysql单机版本.html.f887b50f.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_sentinel快速开始.html.9e9c5385.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_ssh服务登录linux.html.275820ee.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_Odsidian文本编辑器.html.624395cb.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_Jmeter的安装使用.html.97a78258.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_日志架构历史.html.c8ad8d76.js" as="script"><link rel="prefetch" href="/assets/js/blog_工作流_Flowable流程图.html.69727c7c.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_图床神器PicGo_七牛云.html.e5e25d42.js" as="script"><link rel="prefetch" href="/assets/js/blog_Jvm_JVM运行时内存划分.html.680cc2ae.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_xshell8安装.html.45877c0c.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_TCP三次握手.html.36495d53.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_常见问题.html.65bee852.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_idea2024.1.7的下载和激活.html.c336f008.js" as="script"><link rel="prefetch" href="/assets/js/blog_index.html.81e680d7.js" as="script"><link rel="prefetch" href="/assets/js/index.html.c7cb45ee.js" as="script"><link rel="prefetch" href="/assets/js/intro.html.1dcc09ec.js" as="script"><link rel="prefetch" href="/assets/js/category_设计模式_index.html.dcafc54b.js" as="script"><link rel="prefetch" href="/assets/js/tag_设计模式_index.html.618e57d0.js" as="script"><link rel="prefetch" href="/assets/js/category_多线程_index.html.ab6158ff.js" as="script"><link rel="prefetch" href="/assets/js/category_工作流_index.html.85a0aad0.js" as="script"><link rel="prefetch" href="/assets/js/tag_工作流_index.html.489d7bd5.js" as="script"><link rel="prefetch" href="/assets/js/tag_多线程_index.html.8870c7c3.js" as="script"><link rel="prefetch" href="/assets/js/category_springcloud_index.html.6389c3f1.js" as="script"><link rel="prefetch" href="/assets/js/category_springboot_index.html.e8d20360.js" as="script"><link rel="prefetch" href="/assets/js/category_工具_index.html.c51a1024.js" as="script"><link rel="prefetch" href="/assets/js/tag_springcloud_index.html.efa1833a.js" as="script"><link rel="prefetch" href="/assets/js/category_springmvc_index.html.c0dc42a9.js" as="script"><link rel="prefetch" href="/assets/js/category_zookeeper_index.html.38ae050a.js" as="script"><link rel="prefetch" href="/assets/js/tag_springboot_index.html.39c742d4.js" as="script"><link rel="prefetch" href="/assets/js/tag_偏僻_index.html.9b02071e.js" as="script"><link rel="prefetch" href="/assets/js/tag_基础_index.html.3d7e6149.js" as="script"><link rel="prefetch" href="/assets/js/tag_工具_index.html.d63823d9.js" as="script"><link rel="prefetch" href="/assets/js/tag_必看_index.html.c1a697ed.js" as="script"><link rel="prefetch" href="/assets/js/tag_常用_index.html.c851c927.js" as="script"><link rel="prefetch" href="/assets/js/tag_干货_index.html.1e892cab.js" as="script"><link rel="prefetch" href="/assets/js/tag_推荐_index.html.a52644de.js" as="script"><link rel="prefetch" href="/assets/js/tag_进阶_index.html.926d17cf.js" as="script"><link rel="prefetch" href="/assets/js/tag_springmvc_index.html.a00465f5.js" as="script"><link rel="prefetch" href="/assets/js/tag_zookeeper_index.html.18fdf753.js" as="script"><link rel="prefetch" href="/assets/js/category_mybatis_index.html.ab0d8e05.js" as="script"><link rel="prefetch" href="/assets/js/category_docker_index.html.0b609a56.js" as="script"><link rel="prefetch" href="/assets/js/category_spring_index.html.69dd8d33.js" as="script"><link rel="prefetch" href="/assets/js/blog_设计模式_index.html.92a02ba6.js" as="script"><link rel="prefetch" href="/assets/js/tag_mybatis_index.html.2ce597a0.js" as="script"><link rel="prefetch" href="/assets/js/category_dubbo_index.html.0a8208ff.js" as="script"><link rel="prefetch" href="/assets/js/category_mysql_index.html.fd9895b8.js" as="script"><link rel="prefetch" href="/assets/js/category_netty_index.html.3e7e720e.js" as="script"><link rel="prefetch" href="/assets/js/category_nginx_index.html.5da21e16.js" as="script"><link rel="prefetch" href="/assets/js/category_redis_index.html.ea9b64a2.js" as="script"><link rel="prefetch" href="/assets/js/tag_docker_index.html.7eb31738.js" as="script"><link rel="prefetch" href="/assets/js/tag_spring_index.html.83610514.js" as="script"><link rel="prefetch" href="/assets/js/404.html.59a49ed8.js" as="script"><link rel="prefetch" href="/assets/js/category_java_index.html.69febb12.js" as="script"><link rel="prefetch" href="/assets/js/tag_dubbo_index.html.6a2a9b3c.js" as="script"><link rel="prefetch" href="/assets/js/tag_mysql_index.html.29d8be0c.js" as="script"><link rel="prefetch" href="/assets/js/tag_redis_index.html.daf8d093.js" as="script"><link rel="prefetch" href="/assets/js/tag_netty_index.html.42683be4.js" as="script"><link rel="prefetch" href="/assets/js/tag_nginx_index.html.7d8b7b56.js" as="script"><link rel="prefetch" href="/assets/js/category_jvm_index.html.fee1a34f.js" as="script"><link rel="prefetch" href="/assets/js/tag_java_index.html.669228d3.js" as="script"><link rel="prefetch" href="/assets/js/category_mq_index.html.683da66f.js" as="script"><link rel="prefetch" href="/assets/js/blog_多线程_index.html.03b49b5b.js" as="script"><link rel="prefetch" href="/assets/js/blog_工作流_index.html.1279bc70.js" as="script"><link rel="prefetch" href="/assets/js/tag_jvm_index.html.c6857c65.js" as="script"><link rel="prefetch" href="/assets/js/tag_mq_index.html.a686154b.js" as="script"><link rel="prefetch" href="/assets/js/timeline_index.html.91534fbf.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringCloud_index.html.17f3206d.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringBoot_index.html.08387927.js" as="script"><link rel="prefetch" href="/assets/js/category_index.html.8762da89.js" as="script"><link rel="prefetch" href="/assets/js/blog_工具_index.html.fe78a7ea.js" as="script"><link rel="prefetch" href="/assets/js/blog_SpringMvc_index.html.845e4251.js" as="script"><link rel="prefetch" href="/assets/js/article_index.html.986e6fea.js" as="script"><link rel="prefetch" href="/assets/js/blog_zookeeper_index.html.e43b13bf.js" as="script"><link rel="prefetch" href="/assets/js/tag_index.html.4672dabe.js" as="script"><link rel="prefetch" href="/assets/js/star_index.html.7b606cdf.js" as="script"><link rel="prefetch" href="/assets/js/blog_Mybatis_index.html.bf65bb84.js" as="script"><link rel="prefetch" href="/assets/js/blog_Docker_index.html.9c5a487f.js" as="script"><link rel="prefetch" href="/assets/js/blog_Spring_index.html.7a8a77ab.js" as="script"><link rel="prefetch" href="/assets/js/blog_Dubbo_index.html.0fedf4ae.js" as="script"><link rel="prefetch" href="/assets/js/blog_Netty_index.html.6d27af6d.js" as="script"><link rel="prefetch" href="/assets/js/blog_Nginx_index.html.839b919c.js" as="script"><link rel="prefetch" href="/assets/js/blog_Redis_index.html.bf3cac54.js" as="script"><link rel="prefetch" href="/assets/js/blog_mysql_index.html.2fcd2215.js" as="script"><link rel="prefetch" href="/assets/js/blog_Java_index.html.55365ce3.js" as="script"><link rel="prefetch" href="/assets/js/blog_Jvm_index.html.3c70e7cd.js" as="script"><link rel="prefetch" href="/assets/js/blog_MQ_index.html.238eafd0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar auto-hide" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><!----><!----><span class="vp-site-name">Mr.Zyh</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:house" sizing="height" height="1em"></iconify-icon><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/blog/" aria-label="文章"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:book-open" sizing="height" height="1em"></iconify-icon><!--]-->文章<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/category/" aria-label="分类"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:bookmark" sizing="height" height="1em"></iconify-icon><!--]-->分类<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/timeline/" aria-label="时间轴"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:calendar" sizing="height" height="1em"></iconify-icon><!--]-->时间轴<!----></a></div></nav><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><iconify-icon class="vp-icon" icon="fa6-solid:folder-open" sizing="both" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">文章目录</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Jvm</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/blog/Jvm/jvm%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8.html" aria-label="jvm垃圾收集器"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->jvm垃圾收集器<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/blog/Jvm/jvm%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%88%9B%E5%BB%BA.html" aria-label="jvm对象的结构和创建"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->jvm对象的结构和创建<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/Jvm/JVM%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html" aria-label="JVM的垃圾回收机制"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->JVM的垃圾回收机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/Jvm/jvm%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6.html" aria-label="jvm类加载机制"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->jvm类加载机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/Jvm/jvm%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7.html" aria-label="jvm调优工具"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->jvm调优工具<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/blog/Jvm/JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E5%86%85%E5%AD%98%E5%88%92%E5%88%86.html" aria-label="JVM运行时内存划分"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->JVM运行时内存划分<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">MQ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Mybatis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Mysql</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Netty</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Nginx</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring Boot</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring Cloud</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring Mvc</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">多线程</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">工作流</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">工具</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">设计模式</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="height" height="1em"></iconify-icon>jvm对象的结构和创建</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Ms.Zyh</span></span><span property="author" content="Ms.Zyh"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2023/7/16</span><meta property="datePublished" content="2023-07-16T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 15 分钟</span><meta property="timeRequired" content="PT15M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">Jvm</span><!--]--><meta property="articleSection" content="Jvm"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">干货</span><span class="page-tag-item color8 clickable" role="navigation">Jvm</span><!--]--><meta property="keywords" content="干货,Jvm"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h3 id="一-对象的结构" tabindex="-1"><a class="header-anchor" href="#一-对象的结构"><span>一，对象的结构</span></a></h3><img src="http://img.zouyh.top/article-img/20240917135027224.png" alt="image-20230208164713119" style="zoom:80%;"><h4 id="_1-1-对象头" tabindex="-1"><a class="header-anchor" href="#_1-1-对象头"><span>1.1 对象头</span></a></h4><p>​ HotSpot虚拟机的对象头主要包括两部分信息markword和klass，如果是数组实例还会包含数组长度。</p><h5 id="_1-1-2-markword" tabindex="-1"><a class="header-anchor" href="#_1-1-2-markword"><span>1.1.2 markword</span></a></h5><p>​ 第一部分markword,用于存储对象自身的运行时数据，如<strong>哈希码（HashCode）</strong>、<strong>GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳</strong>等，这部分数据的长度在32位和64位的虚拟机（未开启压缩指针）中分别为32bit和64bit，官方称它为“MarkWord”。</p><p>Mark Word的32bit空间里的25位用于存储对象哈希码，4bit用于存储对象分代年龄，2bit用于存储锁标志位，1bit固定为0，表示非偏向锁。其他状态如下图所示：</p><img src="http://img.zouyh.top/article-img/20240917135027225.png" alt="image-20230208164949725" style="zoom:67%;"><p>对象头在hotspot的C++源码里的注释如下：</p><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-c++"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 32 bits:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ‐‐‐‐‐‐‐‐</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// hash:25 ‐‐‐‐‐‐‐‐‐‐‐‐&gt;| age:4 biased_lock:1 lock:2 (normal object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// JavaThread*:23 epoch:2 age:4 biased_lock:1 lock:2 (biased object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// size:32 ‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐&gt;| (CMS free block)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// PromotedObject*:29 ‐‐‐‐‐‐‐‐‐‐&gt;| promo_bits:3 ‐‐‐‐‐&gt;| (CMS promoted object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 64 bits:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ‐‐‐‐‐‐‐‐</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// unused:25 hash:31 ‐‐&gt;| unused:1 age:4 biased_lock:1 lock:2 (normal object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// JavaThread*:54 epoch:2 unused:1 age:4 biased_lock:1 lock:2 (biased object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// PromotedObject*:61 ‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐&gt;| promo_bits:3 ‐‐‐‐‐&gt;| (CMS promoted object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// size:64 ‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐&gt;| (CMS free block)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// unused:25 hash:31 ‐‐&gt;| cms_free:1 age:4 biased_lock:1 lock:2 (COOPs &amp;&amp; normal object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// JavaThread*:54 epoch:2 cms_free:1 age:4 biased_lock:1 lock:2 (COOPs &amp;&amp; biased object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// narrowOop:32 unused:24 cms_free:1 unused:4 promo_bits:3 ‐‐‐‐‐&gt;| (COOPs &amp;&amp; CMS promoted object)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// unused:21 size:35 ‐‐&gt;| cms_free:1 unused:7 ‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐&gt;| (COOPs &amp;&amp; CMS free block)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-1-2-klass" tabindex="-1"><a class="header-anchor" href="#_1-1-2-klass"><span>1.1.2 klass</span></a></h5><p>​ 对象头的另外一部分是klass类型指针，即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例.</p><h5 id="_1-1-3-数组长度" tabindex="-1"><a class="header-anchor" href="#_1-1-3-数组长度"><span>1.1.3 数组长度</span></a></h5><p>​ 数组长度只有数组对象有，如果对象是一个数组, 那在对象头中还必须有一块数据用于记录数组长度.</p><h4 id="_1-2-实例填充" tabindex="-1"><a class="header-anchor" href="#_1-2-实例填充"><span>1.2 实例填充</span></a></h4><p>​ 实例数据部分是对象真正存储的有效信息，也是在程序代码中所定义的各种类型的字段内容。无论是从父类继承下来的，还是在子类中定义的，都需要记录起来。</p><h4 id="_1-3-对齐填充" tabindex="-1"><a class="header-anchor" href="#_1-3-对齐填充"><span>1.3 对齐填充</span></a></h4><p>​ 对齐填充并不是必然存在的，也没有特别的含义，它仅仅起着占位符的作用。由于HotSpot VM的自动内存管理系统要求对象起始地址必须是8字节的整数倍，换句话说，就是对象的大小必须是8字节的整数倍。而对象头部分正好是8字节的倍数（1倍或者2倍），因此，当对象实例数据部分没有对齐时，就需要通过对齐填充来补全。</p><h3 id="二-对象创建时机" tabindex="-1"><a class="header-anchor" href="#二-对象创建时机"><span>二，对象创建时机</span></a></h3><h4 id="_2-1-new关键字" tabindex="-1"><a class="header-anchor" href="#_2-1-new关键字"><span>2.1 new关键字</span></a></h4><p>​ 通过 new关键字创建对象是最常见的，也是最简单的创建对象的方式，通过这种方式我们可以调用任意的构造函数去创建对象：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] args) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    User </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-class类的newinstance方法" tabindex="-1"><a class="header-anchor" href="#_2-2-class类的newinstance方法"><span>2.2 Class类的newInstance方法</span></a></h4><p>​ 通过Java的反射机制使用Class类的newInstance方法来创建对象，这个newInstance方法调用无参的构造器创建对象；</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] args) throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 方式1</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (User)</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">forName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com.zyh.bean.User&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 方式2</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-constructor类的newinstance方法" tabindex="-1"><a class="header-anchor" href="#_2-3-constructor类的newinstance方法"><span>2.3 Constructor类的newInstance方法</span></a></h4><p>​ 通过Java的反射机制获取构造方法类<code>java.lang.relect.Constructor</code>，然后使用Constructor类的newInstance方法来创建对象，通过Constructor的newInstance方法来创建对象比直接使用Class类的newInstance方法来创建对象更强大，我们可以不仅可以通过Constructor类调用无参构造，还可以通过Constructor类调用有参数的和私有的构造函数：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">[] args) throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Constructor</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> constructor </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getConstructor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user3 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> constructor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">newInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-object类的clone方法" tabindex="-1"><a class="header-anchor" href="#_2-4-object类的clone方法"><span>2.4 Object类的clone方法</span></a></h4><p>​ 通过实现Cloneable接口，重写Object类的clone方法来创建对象（浅拷贝），Java为所有对象提供了clone方法（Object类），又出于安全考虑，将它设置为了保护属性：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">protected</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> native</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> clone</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() throws CloneNotSupportedException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Java API采用判断是否实现空接口Cloneable的方法来判断对象所属的类是否支持克隆。如果被克隆对象所属类没有实现该接口，则抛出NotDeclareCloneMethod 异常。当支持克隆时，通过重写Object类的clone方法，并把方法的修饰符改为public，就可以直接调用该类的实例对象的clone方法实现克隆：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Data</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Cloneable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> clone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CloneNotSupportedException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">clone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CloneNotSupportedException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (User)</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">clone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="三-对象创建流程" tabindex="-1"><a class="header-anchor" href="#三-对象创建流程"><span>三，对象创建流程</span></a></h3><h4 id="_3-1-类加载检查" tabindex="-1"><a class="header-anchor" href="#_3-1-类加载检查"><span>3.1 类加载检查</span></a></h4><p>​ 当虚拟机检测到对象创建时机时，首先将去检查这个指令的参数是否能在常量池中定位到对象对应类的符号引用，并且检查这个符号引用代表的类是否已被加载、解析和初始化过，如果没有，那必须先执行相应的类加载过程。</p><h4 id="_3-2-分配内存" tabindex="-1"><a class="header-anchor" href="#_3-2-分配内存"><span>3.2 分配内存</span></a></h4><p>​ 在类加载检查通过后，接下来虚拟机将为新生对象分配内存，对象所需内存的大小在类加载完成后便可完全确定，为对象分配空间的任务等同于把一块确定大小的内存从Java堆中划分出来，划分的方式有指针碰撞和空闲列表两种方式：</p><ul><li>指针碰撞：如果堆内存是规整的空间，即已经分配的内存与未使用的内存都是连续的空间，此时存在着一个指针位于已用与可用内存的分界，新内存的分配即指针移动对象大小的距离即可。此方式称为指针碰撞。</li><li>空闲列表：如果堆空间中已分配的内存与未分配的内存相互交错，就需要使用“空闲列表”的方式进行内存分配操作。此时堆内存中维护了一份可用内存的列表，当有新内存分配的需求时，会到空闲列表中确定足够大小的内存空间予以分配操作。</li></ul><p>存在的问题：由于堆空间是线程共享的，所以该方式存在着并发问题。</p><p>解决方式：</p><ul><li><p>对内存分配的动作进行同步处理，虚拟机采用CAS配上失败重试的方式，保证更新操作的原子性来对分配内存空间的动作进行同步处理；</p></li><li><p>本地线程分配缓冲（LTAB）：将内存按照分配的动作按线程划分在不同的空间进行，即每个线程在Java堆中预先申请一块内存(LTAB)，哪个线程需要分配空间，就在哪个线程的LTAB上执行。只有当某一线程的LTAB用完了才执行同步锁定。</p></li></ul><h4 id="_3-3-初始化" tabindex="-1"><a class="header-anchor" href="#_3-3-初始化"><span>3.3 初始化</span></a></h4><p>​ 内存分配完成后，虚拟机需要将分配到的内存空间都初始化为零值（不包括对象头）， 如果使用TLAB，这一工作过程也可以提前至TLAB分配时进行。正是应为初始化操的存在，对象的成员变量不用手动初始化赋值直接使用，方法中声明的变量需要手动赋值的原因。</p><h4 id="_3-4-设置对象头" tabindex="-1"><a class="header-anchor" href="#_3-4-设置对象头"><span>3.4 设置对象头</span></a></h4><p>​ 初始化之后，虚拟机要对对象进行必要的设置，例如这个对象是哪个类的实例、如何才能找到类的元数据信息、对象的哈希码、对象的GC分代年龄等信息，这些信息存放在对象的对象头Object Header之中，在上面&quot;对象的结构”中介绍了。</p><h4 id="_3-5-执行-init-方法" tabindex="-1"><a class="header-anchor" href="#_3-5-执行-init-方法"><span>3.5 执行<code>&lt;init&gt;</code>方法</span></a></h4><pre><code>执行`&lt;init&gt;`方法，即对象按照程序员的意愿进行初始化，对应到语言层面上讲执行构造方法为属性赋值。
</code></pre><blockquote><p>注意：这里的赋值上面的初始化赋零值不同，</p></blockquote><h3 id="四-jvm对象分配策略" tabindex="-1"><a class="header-anchor" href="#四-jvm对象分配策略"><span>四，JVM对象分配策略</span></a></h3><h4 id="_4-1-优先分配到伊甸园eden" tabindex="-1"><a class="header-anchor" href="#_4-1-优先分配到伊甸园eden"><span>4.1 优先分配到伊甸园eden</span></a></h4><p>大多数情况下，对象在新生代中 Eden 区分配。当 Eden 区没有足够空间进行分配时，虚拟机将发起一次Minor GC。我 们来进行实际测试一下：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 添加运行JVM参数，是运行参数不要Debug启动： ‐XX:+PrintGCDetails</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GCTest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">        byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] allocation1, allocation2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*, allocation3, allocation4, allocation5, allocation6*/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">60000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        //allocation2 = new byte[8000*1024];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        /*allocation3 = new byte[1000*1024];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        allocation4 = new byte[1000*1024];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        allocation5 = new byte[1000*1024];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        allocation6 = new byte[1000*1024];*/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Heap </span></span>
<span class="line"><span>PSYoungGen total 76288K, used 65536K [0x000000076b400000, 0x0000000770900000, 0x00000007c0000000) </span></span>
<span class="line"><span>    eden space 65536K, 100% used [0x000000076b400000,0x000000076f400000,0x000000076f400000) </span></span>
<span class="line"><span>    from space 10752K, 0% used [0x000000076fe80000,0x000000076fe80000,0x0000000770900000) </span></span>
<span class="line"><span>    to space 10752K, 0% used [0x000000076f400000,0x000000076f400000,0x000000076fe80000) </span></span>
<span class="line"><span>ParOldGen total 175104K, used 0K [0x00000006c1c00000, 0x00000006cc700000, 0x000000076b400000) </span></span>
<span class="line"><span>	object space 175104K, 0% used [0x00000006c1c00000,0x00000006c1c00000,0x00000006cc700000)</span></span>
<span class="line"><span>Metaspace used 3342K, capacity 4496K, committed 4864K, reserved 1056768K</span></span>
<span class="line"><span>	class space used 361K, capacity 388K, committed 512K, reserved 1048576K</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 我们可以看出eden区内存几乎已经被分配完全，假如我们再为 allocation2分配内存会出现什么情况呢？</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GCTest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">        byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] allocation1, allocation2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*, allocation3, allocation4, allocation5, allocation6*/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">60000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        /*allocation3 = new byte[1000*1024];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        allocation4 = new byte[1000*1024];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        allocation5 = new byte[1000*1024];</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        allocation6 = new byte[1000*1024];*/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>[GC (Allocation Failure) [PSYoungGen: 65253K‐&gt;936K(76288K)] 65253K‐&gt;60944K(251392K), 0.0279083 secs] [Times: user=0.13 sys=0.02, real=0.03 secs] </span></span>
<span class="line"><span>Heap </span></span>
<span class="line"><span>PSYoungGen total 76288K, used 9591K [0x000000076b400000, 0x0000000774900000, 0x00000007c0000000) </span></span>
<span class="line"><span>	eden space 65536K, 13% used [0x000000076b400000,0x000000076bc73ef8,0x000000076f400000) </span></span>
<span class="line"><span>	from space 10752K, 8% used [0x000000076f400000,0x000000076f4ea020,0x000000076fe80000) </span></span>
<span class="line"><span>	to space 10752K, 0% used [0x0000000773e80000,0x0000000773e80000,0x0000000774900000) </span></span>
<span class="line"><span>ParOldGen total 175104K, used 60008K [0x00000006c1c00000, 0x00000006cc700000, 0x000000076b400000) </span></span>
<span class="line"><span>	object space 175104K, 34% used [0x00000006c1c00000,0x00000006c569a010,0x00000006cc700000)</span></span>
<span class="line"><span>Metaspace used 3342K, capacity 4496K, committed 4864K, reserved 1056768K </span></span>
<span class="line"><span>	class space used 361K, capacity 388K, committed 512K, reserved 1048576K</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 分析为什么会出现这种情况： 因为给allocation2分配内存的时候eden区内存几乎已经被分配完了，我们刚刚讲了当Eden区没有足够空间进行分配时，虚拟机将发起一次Minor GC，GC期间虚拟机又发现allocation1无法存入Survior空间，所以只好把新生代的对象提前转移到老年代中去，老年代上的空间足够存放allocation1，所以不会出现Full GC。执行Minor GC后，后面分配的对象如果能够存在eden区的话，还是会在eden区分配内存，如上eden区使用13%还剩大约4M,可以执行如下代码验证：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GCTest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">        byte</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation1</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation2</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation3</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation4</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation5</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation1 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">60000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation2 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation3 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation4 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation5 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        allocation6 </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>[GC (Allocation Failure) [PSYoungGen: 65253K‐&gt;952K(76288K)] 65253K‐&gt;60960K(251392K), 0.0311467 secs] [Times: user=0.08 sys=0.02, real=0.03 secs] </span></span>
<span class="line"><span>Heap </span></span>
<span class="line"><span>PSYoungGen total 76288K, used 13878K [0x000000076b400000, 0x0000000774900000, 0x00000007c0000000) </span></span>
<span class="line"><span>	eden space 65536K, 19% used [0x000000076b400000,0x000000076c09fb68,0x000000076f400000) </span></span>
<span class="line"><span>	from space 10752K, 8% used [0x000000076f400000,0x000000076f4ee030,0x000000076fe80000) </span></span>
<span class="line"><span>	to space 10752K, 0% used [0x0000000773e80000,0x0000000773e80000,0x0000000774900000) </span></span>
<span class="line"><span>ParOldGen total 175104K, used 60008K [0x00000006c1c00000, 0x00000006cc700000, 0x000000076b400000) </span></span>
<span class="line"><span>	object space 175104K, 34% used [0x00000006c1c00000,0x00000006c569a010,0x00000006cc700000) </span></span>
<span class="line"><span>Metaspace used 3343K, capacity 4496K, committed 4864K, reserved 1056768K </span></span>
<span class="line"><span>	class space used 361K, capacity 388K, committed 512K, reserved 1048576K</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ eden的使用率增加了6%，所以说优先分配到伊甸园eden</p><h4 id="_4-2-大的对象直接分配到老年代" tabindex="-1"><a class="header-anchor" href="#_4-2-大的对象直接分配到老年代"><span>4.2 大的对象直接分配到老年代</span></a></h4><p>​ 大对象就是需要大量连续内存空间的对象（比如：字符串、数组）。JVM参数<code>-XX:PretenureSizeThreshold</code>可以设置大对象的大小，如果对象超过设置大小会直接进入老年代，不会进入年轻代，这个参数只在 Serial 和ParNew两个收集器下有效。</p><p>比如执行下面程序会发现大对象直接进了老年代:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 添加运行JVM参数： -XX:PretenureSizeThreshold=1000000 -XX:+UseSerialGC ‐XX:+PrintGCDetails</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// -XX:+UseSerialGC 表示使用Serial垃圾收集器</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// -XX:PretenureSizeThreshold=1000000 表示大对象时1000000字节，单位时字节</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ‐XX:+PrintGCDetails 表示打印gc日志</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> GCTest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">        byte</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;"> byte</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">60000</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Heap</span></span>
<span class="line"><span> def new generation   total 39296K, used 5613K [0x0000000081c00000, 0x00000000846a0000, 0x00000000abd50000)</span></span>
<span class="line"><span>  eden space 34944K,  16% used [0x0000000081c00000, 0x000000008217b418, 0x0000000083e20000)</span></span>
<span class="line"><span>  from space 4352K,   0% used [0x0000000083e20000, 0x0000000083e20000, 0x0000000084260000)</span></span>
<span class="line"><span>  to   space 4352K,   0% used [0x0000000084260000, 0x0000000084260000, 0x00000000846a0000)</span></span>
<span class="line"><span> tenured generation   total 87424K, used 60000K [0x00000000abd50000, 0x00000000b12b0000, 0x0000000100000000)</span></span>
<span class="line"><span>   the space 87424K,  68% used [0x00000000abd50000, 0x00000000af7e8010, 0x00000000af7e8200, 0x00000000b12b0000)</span></span>
<span class="line"><span> Metaspace       used 3750K, capacity 4596K, committed 4864K, reserved 1056768K</span></span>
<span class="line"><span>  class space    used 412K, capacity 432K, committed 512K, reserved 1048576K</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分析发现老年代的内存占了68%，一共87424K，大概就是我程序分配的60000K，符合结论。</p><p>为什么要大的对象直接分配到老年代，是为了避免为大对象分配内存时的复制操作而降低效率。</p><h4 id="_4-3-长期存活的对象分配到老年代" tabindex="-1"><a class="header-anchor" href="#_4-3-长期存活的对象分配到老年代"><span>4.3 长期存活的对象分配到老年代</span></a></h4><p>​ 既然虚拟机采用了分代收集的思想来管理内存，那么内存回收时就必须能识别哪些对象应放在新生代，哪些对象应放在 老年代中。为了做到这一点，虚拟机给每个对象一个对象年龄（Age）计数器。 如果对象在 Eden 出生并经过第一次 Minor GC 后仍然能够存活，并且能被 Survivor 容纳的话，将被移动到 Survivor 空间中，并将对象年龄设为1。对象在 Survivor 中每熬过一次 MinorGC，年龄就增加1岁，当它的年龄增加到一定程度 （默认为15岁，CMS收集器默认6岁，不同的垃圾收集器会略微有点不同），就会被晋升到老年代中。对象晋升到老年代 的年龄阈值，可以通过参数<code> -XX:MaxTenuringThreshold</code> 来设置</p><h4 id="_4-4-动态对象的年龄判断" tabindex="-1"><a class="header-anchor" href="#_4-4-动态对象的年龄判断"><span>4.4 动态对象的年龄判断</span></a></h4><p>​ 当前放对象的Survivor区域里(其中一块区域，放对象的那块s区)，一批对象的总大小大于这块Survivor区域内存大小的 50%(-XX:TargetSurvivorRatio可以指定)，那么此时大于等于这批对象年龄最大值的对象，就可以直接进入老年代了， 例如Survivor区域里现在有一批对象，年龄1+年龄2+年龄n的多个年龄对象总和超过了Survivor区域的50%，此时就会 把年龄n(含)以上的对象都放入老年代。这个规则其实是希望那些可能是长期存活的对象，尽早进入老年代。对象动态年 龄判断机制一般是在minor gc之后触发的。</p><h4 id="_4-5-空间担保" tabindex="-1"><a class="header-anchor" href="#_4-5-空间担保"><span>4.5 空间担保</span></a></h4><p>新生代Minor GC后剩余存活对象太多，无法放入Survivor区中，此时由老年代做内存担保，将这些存活对象直接转移到老年代去。</p><ol><li>执行任何一次Minor GC之前，JVM会先检查一下老年代可用内存空间，是否大于新生代所有对象的总大小，因为在极端情况下，可能新生代Minor GC之后，新生代所有对象都需要存活，那就会造成新生代所有对象全部要进入老年代；</li><li>如果老年代的可用内存大于新生代所有对象总大小，此时就可以放心大胆的对新生代发起一次Minor GC，因为Minor GC之后即使所有对象都存活，Survivor区放不下了，也可以转移到老年代去；</li><li>如果老年代的可用空间已经小于新生代的全部对象总大小，那么就会进行下一个判断，判断老年代的可用空间大小，是否大于之前每一次Minor GC后进入老年代的对象的平均大小.</li><li>如果判断发现老年代的内存大小，大于之前每一次Minor GC后进入老年代的对象的平均大小，那么就是说可以冒险尝试一下Minor GC，但是此时真的可能有风险，那就是Minor GC过后，剩余的存活对象的大小，大于Survivor空间的大小，也大于老年代可用空间的大小，老年代都放不下这些存活对象了，此时就会触发一次“Full GC”；</li></ol><img src="http://img.zouyh.top/article-img/20240917135027223.jpg" alt="01-jvm内存担保" style="zoom:50%;"><p>​ 内存担保机制通过，冒险尝试一下Minor GC，Minor GC过后，剩余的存活对象的大小，如果小于老年代可用空间，可以减少一次full GC,所以老年代空间分配担保机制的目的,也是为了避免频繁进行Full GC.</p><h3 id="五-逃逸分析-补充" tabindex="-1"><a class="header-anchor" href="#五-逃逸分析-补充"><span>五，逃逸分析（补充）</span></a></h3><p>在逃逸分析和栈上分配之前，我们可以先简单了解一下它们的基本定义：</p><ul><li>逃逸分析（个人理解）：就是方法内的对象，可以被方法外所访问。</li><li>栈上分配：就是把没发生逃逸的对象，在栈分配空间，一般对象分配空间是在堆。</li></ul><p>二者联系，jvm根据对象是否发生逃逸，会分配到不同（堆或栈）的存储空间。</p><ul><li>如果对象发生逃逸，那会分配到堆中，因为对象发生了逃逸，就代表这个对象可以被外部访问，换句话说，就是可以共享，能共享数据的，无非就是堆或方法区，这里就是堆。</li><li>如果对象没发生逃逸，那会分配到栈中，因为对象没发生逃逸，那就代表这个对象不能被外部访问，换句话说，就是不可共享，这里就是栈。</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> A</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> obj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 方法返回A对象,发生逃逸。</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> A</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getInstance</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">obj</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">obj;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 为成员属性赋值,发生逃逸</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> setObj</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">obj</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 没有发生逃逸。对象的作用域尽在当前方法中有效，没有发生逃逸。</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useA</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        A</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> s</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那我们再想深一层，为什么会有逃逸分析，有栈上分配这些东西？</p><p>​ 当然是为了主体的考虑，主体就是jvm，或者直接说为了GC考虑也不为过。大家想想，GC主要回收的对象是堆和方法区。GC不会对栈、程序计数器这些进行回收的，因为没东西可以回收。</p><p>​ 话又说回来，如果方法逃逸，那么对象就会分配在堆中，这个时候，GC就要工作了。如果没发生方法逃逸，那么对象就分配在栈中，当方法结束后，资源就自动释放了，GC压根不用操心。</p></div><!----><!----><!----></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">最近更新</span><time class="vp-meta-info" datetime="2025-09-20T07:21:23.000Z" data-allow-mismatch>2025/9/20 07:21</time></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 898362059@qq.pcom">zyh1020</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/blog/Jvm/jvm%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8.html" aria-label="jvm垃圾收集器"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="height" height="1em"></iconify-icon>jvm垃圾收集器</div></a><a class="route-link auto-link next" href="/blog/Jvm/JVM%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html" aria-label="JVM的垃圾回收机制"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">JVM的垃圾回收机制<iconify-icon class="vp-icon" icon="fa6-solid:file-lines" sizing="height" height="1em"></iconify-icon></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">豫ICP备2022026603号</div><div class="vp-copyright">Copyright © 2025 Ms.Zyh </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.5f83f5f7.js" defer></script><script src="/assets/js/3836.cbb80532.js" defer></script><script src="/assets/js/app.69f6dbe1.js" defer></script>
  </body>
</html>
